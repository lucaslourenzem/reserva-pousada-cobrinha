<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seja Bem‚ÄëVindo Pescador! ¬∑ Pousada do Cobrinha</title>
  <style>
    :root{
      --bg:#f7f2e7;           /* papel antigo */
      --ink:#2d2a26;          /* tinta */
      --accent:#1e6f5c;       /* verde pescaria */
      --accent-2:#b87333;     /* cobre/retro */
      --wood:#7a5230;         /* madeira */
      --muted:#6a5f55;
      --error:#b00020;
      --ok:#1b5e20;
    }
    html,body{background:var(--bg);color:var(--ink);font-family: ui-serif, Georgia, "Times New Roman", Times, serif;}
    .wrap{max-width:980px;margin:24px auto;padding:24px}
    .card{
      background:linear-gradient(180deg,#fff8ee,#f7efdf);
      border:2px solid var(--wood);
      box-shadow: 0 6px 0 var(--wood), 0 10px 20px rgba(0,0,0,.08);
      border-radius:18px; padding:24px; position:relative;
    }
    header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
    header img{width:70px;height:70px;object-fit:contain;border-radius:50%;border:2px solid var(--accent-2);background:#fff}
    h1{font-size:clamp(22px,3.8vw,36px);margin:0;color:var(--wood);letter-spacing:.03em}
    .subtitle{color:var(--muted);margin-top:4px}

    form{display:grid;grid-template-columns: repeat(12, 1fr);gap:14px;margin-top:14px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-weight:700;color:var(--wood);}
    .field input, .field select, .field textarea{
      padding:10px 12px;border:2px solid var(--wood);border-radius:12px;background:#fff;
      font-size:15px;outline:none;transition: box-shadow .15s ease, border-color .15s ease;
    }
    .field input:focus, .field select:focus, .field textarea:focus{box-shadow:0 0 0 4px rgba(184,115,51,.22);border-color:var(--accent-2)}
    .col-6{grid-column: span 6}
    .col-4{grid-column: span 4}
    .col-3{grid-column: span 3}
    .col-8{grid-column: span 8}
    .col-12{grid-column: 1 / -1}

    .row{display:grid;grid-template-columns: repeat(12, 1fr);gap:14px}
    .hint{font-size:12px;color:var(--muted)}
    .pill{display:inline-block;padding:6px 10px;border:2px dashed var(--accent-2);border-radius:999px;color:var(--accent-2);background:#fff8f0;font-weight:700}

    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
    button{cursor:pointer;border:none;border-radius:12px;padding:12px 16px;font-weight:800;letter-spacing:.02em}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-secondary{background:var(--accent-2);color:#fff}
    .btn-outline{background:#fff;border:2px solid var(--wood);color:var(--wood)}

    .tag{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 10px;font-size:12px;border:1px solid #d6c7b7;color:#5b4f45;background:#fff}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}

    .notice{border-left:6px solid var(--accent-2);background:#fff7ef;padding:12px;border-radius:12px}
    .error{color:var(--error)}
    .ok{color:var(--ok)}

    .totals{background:#fff;border:2px solid var(--wood);border-radius:16px;padding:14px}
    .totals h3{margin-top:0}
    .totals dl{display:grid;grid-template-columns:1fr auto;gap:8px;font-variant-numeric: tabular-nums}
    .totals dt{color:var(--muted)}
    .totals dd{margin:0;font-weight:800}

    footer{margin-top:18px;color:var(--muted);font-size:12px}
    @media (max-width:780px){.col-6,.col-4,.col-3,.col-8{grid-column:1/-1}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <img src="logo.png" alt="Pousada do Cobrinha" />
        <div>
          <h1>Seja Bem‚ÄëVindo Pescador!</h1>
          <div class="subtitle">Preencha sua simula√ß√£o de reserva. Nosso sistema verifica disponibilidade e calcula o or√ßamento.</div>
        </div>
      </header>

      <div class="notice">
        <span class="pill">Dica</span> Voc√™ pode salvar este arquivo como <b>reserva_pousada_cobrinha.html</b> e abrir no navegador. Coloque o logo como <b>logo.png</b> na mesma pasta. Configure as vari√°veis <code>WEBHOOK_URL</code> e <code>CHECK_AVAIL_URL</code> no c√≥digo para integrar ao n8n.
      </div>

      <form id="bookingForm">
        <div class="field col-6">
          <label for="nome">Nome</label>
          <input id="nome" name="nome" type="text" required minlength="3" placeholder="Seu nome completo" />
        </div>
        <div class="field col-6">
          <label for="contato">Forma de Contato</label>
          <select id="contato" name="contato" required>
            <option value="WhatsApp">WhatsApp</option>
            <option value="Email">E-mail</option>
          </select>
        </div>

        <div class="field col-6">
          <label for="email">E‚Äëmail</label>
          <input id="email" name="email" type="email" placeholder="ex: lucas@example.com" />
          <span class="hint">Obrigat√≥rio se a forma de contato for E-mail.</span>
        </div>
        <div class="field col-6">
          <label for="telefone">Telefone</label>
          <input id="telefone" name="telefone" type="tel" placeholder="(xx) xxxxx-xxxx" pattern="^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$" />
          <span class="hint">Obrigat√≥rio se a forma de contato for WhatsApp.</span>
        </div>

        <div class="field col-4">
          <label for="check_in">Check‚Äëin</label>
          <input id="check_in" name="check_in" type="date" required />
        </div>
        <div class="field col-4">
          <label for="check_out">Check‚Äëout</label>
          <input id="check_out" name="check_out" type="date" required />
        </div>
        <div class="field col-2">
          <label for="hrs_checkin">Hora In</label>
          <input id="hrs_checkin" name="hrs_checkin" type="time" />
        </div>
        <div class="field col-2">
          <label for="hrs_checkout">Hora Out</label>
          <input id="hrs_checkout" name="hrs_checkout" type="time" />
        </div>

        <div class="field col-4">
          <label for="estadia">Tipo de Estadia</label>
          <select id="estadia" name="estadia" required>
            <option value="Quarto">Quarto</option>
            <option value="Camping">Camping</option>
          </select>
        </div>
        <div class="field col-4">
          <label for="acomodacao">Acomoda√ß√£o</label>
          <select id="acomodacao" name="acomodacao" required>
            <option value="Casa">Casa (4‚Äì8)</option>
            <option value="Apartamento">Apartamento (2‚Äì4)</option>
            <option value="Suite">Su√≠te (2‚Äì4)</option>
            <option value="Camping">Camping (2‚Äì20)</option>
          </select>
          <span class="hint">Sugest√£o autom√°tica com base no n¬∫ de pessoas.</span>
        </div>
        <div class="field col-2">
          <label for="adultos">Adultos</label>
          <input id="adultos" name="adultos" type="number" min="1" max="20" value="4" required />
        </div>
        <div class="field col-2">
          <label for="criancas">Crian√ßas</label>
          <input id="criancas" name="criancas" type="number" min="0" max="20" value="2" />
        </div>

        <div class="field col-4">
          <label for="plano_refeicao">Plano de Refei√ß√£o</label>
          <select id="plano_refeicao" name="plano_refeicao" required>
            <option value="Cafe">Caf√©</option>
            <option value="Cafe_Almoco">Caf√©_Almo√ßo</option>
            <option value="Completo" selected>Completo</option>
            <option value="Sem">Sem</option>
          </select>
        </div>
        <div class="field col-4">
          <label for="dias_pesca">Dias de Pesca</label>
          <input id="dias_pesca" name="dias_pesca" type="number" min="0" max="30" value="1" />
        </div>
        <div class="field col-4">
          <label for="pirangueiro">Pirangueiro(s)</label>
          <input id="pirangueiro" name="pirangueiro" type="number" min="0" max="10" value="1" />
        </div>

        <div class="field col-12">
          <div class="btns">
            <button class="btn-outline" type="button" id="btnSuggest">Sugerir Acomoda√ß√£o</button>
            <button class="btn-secondary" type="button" id="btnAvailability">Verificar Disponibilidade</button>
            <button class="btn-primary" type="button" id="btnQuote">Calcular Or√ßamento</button>
          </div>
          <div id="availabilityMsg" class="hint" style="margin-top:6px"></div>
        </div>

        <div class="col-12 totals" id="totalsBox" hidden>
          <h3>Resumo do Or√ßamento</h3>
          <dl>
            <dt>Noites</dt><dd id="t_noites">0</dd>
            <dt>Pessoas (aloca√ß√£o)</dt><dd id="t_pessoas">0</dd>
            <dt>Base di√°ria</dt><dd id="t_diaria">R$ 0,00</dd>
            <dt>Subtotal hospedagem</dt><dd id="t_subtotal">R$ 0,00</dd>
            <dt>Pescaria</dt><dd id="t_pescaria">R$ 0,00</dd>
            <dt><b>Total estimado</b></dt><dd id="t_total"><b>R$ 0,00</b></dd>
          </dl>
          <div class="hint">* Crian√ßas contam como 0,5 apenas para <em>valor</em>, n√£o para <em>aloca√ß√£o</em>.</div>
        </div>

        <div class="col-12 btns">
          <button class="btn-primary" type="submit">Enviar Reserva</button>
          <span class="tag">Status inicial: <b>N√£o</b> (confirma√ß√£o ap√≥s dep√≥sito de 50%)</span>
        </div>
      </form>

      <footer>
        ¬© <span id="year"></span> Pousada do Cobrinha ¬∑ Layout retr√¥ com alma de pescador üé£
      </footer>
    </div>
  </div>

  <script>
    // ======================
    // CONFIGURA√á√ÉO n8n
    // ======================
    const WEBHOOK_URL     = "https://SEU_HOST/webhook/make-booking"; // produ√ß√£o
    const CHECK_AVAIL_URL = "https://SEU_HOST/webhook/check-availability"; // implemente no n8n

    // ======================
    // UTILIT√ÅRIOS
    // ======================
    const $$ = sel => document.querySelector(sel);
    const fmtBRL = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    const todayISO = () => new Date().toISOString().slice(0,10);
    const addDays = (d,n)=>{const x=new Date(d);x.setDate(x.getDate()+n);return x.toISOString().slice(0,10)};

    // datas padr√£o (exemplo do enunciado)
    window.addEventListener('DOMContentLoaded',()=>{
      $$('#check_in').value = addDays(todayISO(), 10);
      $$('#check_out').value = addDays(todayISO(), 14);
      $$('#nome').value = '';
      $$('#email').value = 'lucas@example.com';
      document.getElementById('year').textContent = new Date().getFullYear();
    });

    function nights(ci, co){
      const a = new Date(ci); const b = new Date(co);
      const diff = (b - a) / (1000*60*60*24);
      return Math.max(0, Math.round(diff));
    }

    function peopleAllocation(adultos, criancas){
      return Number(adultos||0) + Number(criancas||0); // crian√ßas inteiras para ALOCA√á√ÉO
    }
    function peopleBilling(adultos, criancas){
      return Number(adultos||0) + 0.5*Number(criancas||0); // crian√ßas = 0.5 para VALOR
    }

    function baseRate(estadia, plano){
      if(estadia === 'Camping') return 80; // por pessoa/dia
      // Quarto
      const map = { 'Cafe':250, 'Cafe_Almoco':300, 'Completo':350, 'Sem':250 };
      return map[plano] ?? 250;
    }

    function suggestAccommodation(){
      const total = peopleAllocation($$('#adultos').value, $$('#criancas').value);
      const estadia = $$('#estadia').value;
      if(estadia === 'Camping'){ $$('#acomodacao').value = 'Camping'; return 'Camping'; }
      // heur√≠stica simples
      if(total >= 5 && total <= 8){ $$('#acomodacao').value = 'Casa'; return 'Casa'; }
      if(total >= 2 && total <= 4){ $$('#acomodacao').value = 'Apartamento'; return 'Apartamento'; }
      if(total > 8){ $$('#acomodacao').value = 'Casa'; return 'Casa'; }
      // fallback
      $$('#acomodacao').value = 'Suite'; return 'Suite';
    }

    async function checkAvailability(){
      const payload = collectForm();
      setAvailability('Verificando disponibilidade‚Ä¶');
      try{
        if(CHECK_AVAIL_URL.startsWith('https://SEU_HOST')){
          // Simula√ß√£o local enquanto a API n√£o est√° pronta
          await new Promise(r=>setTimeout(r,600));
          setAvailability('Exemplo: disponibilidade OK (configure CHECK_AVAIL_URL no n8n).', 'ok');
          return { available:true };
        }
        const res = await fetch(CHECK_AVAIL_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        const data = await res.json();
        setAvailability(data.available? 'Dispon√≠vel ‚úÖ':'Indispon√≠vel ‚ùå', data.available?'ok':'error');
        return data;
      }catch(err){
        console.error(err);
        setAvailability('Erro ao verificar disponibilidade.', 'error');
        return { available:false, error: String(err) };
      }
    }

    function setAvailability(msg, type){
      const el = $$('#availabilityMsg');
      el.textContent = msg;
      el.classList.remove('error','ok');
      if(type==='ok') el.classList.add('ok');
      if(type==='error') el.classList.add('error');
    }

    function calcQuote(){
      const ci = $$('#check_in').value; const co = $$('#check_out').value;
      const n = nights(ci,co);
      if(n<=0) throw new Error('Datas inv√°lidas: check-out deve ser ap√≥s o check-in.');
      const adultos = Number($$('#adultos').value||0);
      const criancas = Number($$('#criancas').value||0);
      const estadia = $$('#estadia').value;
      const plano = $$('#plano_refeicao').value;
      const ppAlloc = peopleAllocation(adultos, criancas);
      const ppBill  = peopleBilling(adultos, criancas);
      const diaria = baseRate(estadia, plano);
      const subtotal = diaria * ppBill * n;
      const pesca = 450 * Number($$('#dias_pesca').value||0) * Number($$('#pirangueiro').value||0);
      const total = subtotal + pesca;
      return { noites:n, pessoas:ppAlloc, diaria, subtotal, pesca, total };
    }

    function showTotals(t){
      $$('#t_noites').textContent = t.noites;
      $$('#t_pessoas').textContent = t.pessoas;
      $$('#t_diaria').textContent = fmtBRL(t.diaria);
      $$('#t_subtotal').textContent = fmtBRL(t.subtotal);
      $$('#t_pescaria').textContent = fmtBRL(t.pesca);
      $$('#t_total').textContent = fmtBRL(t.total);
      $$('#totalsBox').hidden = false;
    }

    function collectForm(){
      const f = document.getElementById('bookingForm');
      const o = Object.fromEntries(new FormData(f).entries());
      // coer√ß√£o num√©rica
      ['adultos','criancas','dias_pesca','pirangueiro'].forEach(k=>o[k]=Number(o[k]||0));
      // valida√ß√£o b√°sica
      if(o.contato==='Email' && !o.email) throw new Error('E-mail √© obrigat√≥rio quando a forma de contato √© E-mail.');
      if(o.contato==='WhatsApp' && !o.telefone) throw new Error('Telefone √© obrigat√≥rio quando a forma de contato √© WhatsApp.');
      if(new Date(o.check_out) <= new Date(o.check_in)) throw new Error('Check-out deve ser ap√≥s o check-in.');
      // capacidade por acomoda√ß√£o
      const cap = { Casa:[4,8], Apartamento:[2,4], Suite:[2,4], Camping:[2,20] };
      const total = peopleAllocation(o.adultos,o.criancas);
      const lim = cap[o.acomodacao];
      if(lim && (total < lim[0] || total > lim[1])){
        throw new Error(`Capacidade de ${o.acomodacao}: ${lim[0]}‚Äì${lim[1]} pessoas (para aloca√ß√£o).`);
      }
      // status inicial
      o.status = 'Nao';
      return o;
    }

    // Bot√µes
    document.getElementById('btnSuggest').addEventListener('click', ()=>{
      const s = suggestAccommodation();
      setAvailability(`Sugest√£o de acomoda√ß√£o: ${s}`);
    });

    document.getElementById('btnAvailability').addEventListener('click', checkAvailability);

    document.getElementById('btnQuote').addEventListener('click', ()=>{
      try{ const q = calcQuote(); showTotals(q); setAvailability(''); }
      catch(e){ alert(e.message); }
    });

    // Submit ‚Üí enviar para n8n
    document.getElementById('bookingForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      try{
        const payload = collectForm();
        const quote = calcQuote();
        const body = { ...payload, ...{ valor_estimado: quote.total, noites: quote.noites } };
        if(WEBHOOK_URL.startsWith('https://SEU_HOST')){
          alert('Configure WEBHOOK_URL para enviar ao n8n. Simula√ß√£o conclu√≠da.');
          return;
        }
        const res = await fetch(WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
        const data = await res.json().catch(()=>({}));
        if(res.ok){
          alert('Reserva enviada com sucesso!\nProtocolo: ' + (data.reserva_id || '‚Äî'));
        } else {
          alert('Falha ao enviar: ' + (data.error || res.statusText));
        }
      }catch(err){
        alert(err.message);
      }
    });
  </script>
</body>
</html>